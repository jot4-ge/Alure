% rebase('base.tpl', title='Remover Produto')

<main class="admin-container">
    <h1>Remover Produto</h1>
    
    <div class="search-container">
        <input type="text" id="searchProduct" placeholder="Buscar produto por nome ou ID..." class="search-input">
        <button id="searchBtn" class="btn btn-primary">Buscar</button>
    </div>
    
    <div id="productList" class="product-list">
        % if products:
            % for product in products:
            <div class="product-item" data-id="{{product.id}}">
                <div class="product-info">
                    <img src="{{product.images[0] if product.images else '/static/img/placeholder.jpg'}}" alt="{{product.name}}" class="product-image">
                    <div class="product-details">
                        <h3>{{product.name}}</h3>
                        <p class="product-id">ID: {{product.id}}</p>
                        <p class="product-category">Categoria: {{product.category}}</p>
                        <p class="product-stock">Estoque: {{product.stock}}</p>
                    </div>
                </div>
                <button class="btn btn-danger delete-btn" data-id="{{product.id}}">Remover</button>
            </div>
            % end
        % else:
            <p class="no-products">Nenhum produto encontrado.</p>
        % end
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Confirmar Exclusão</h3>
            <p>Tem certeza que deseja remover este produto? Esta ação não pode ser desfeita.</p>
            <div class="modal-actions">
                <button id="confirmDelete" class="btn btn-danger">Sim, Remover</button>
                <button id="cancelDelete" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>
</main>

<script>
    // This would be moved to a separate JS file in a production environment
    document.addEventListener('DOMContentLoaded', function() {
        const deleteButtons = document.querySelectorAll('.delete-btn');
        const confirmModal = document.getElementById('confirmModal');
        const confirmDeleteBtn = document.getElementById('confirmDelete');
        const cancelDeleteBtn = document.getElementById('cancelDelete');
        const searchInput = document.getElementById('searchProduct');
        const searchBtn = document.getElementById('searchBtn');
        
        let productToDelete = null;
        
        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                productToDelete = this.getAttribute('data-id');
                confirmModal.style.display = 'block';
            });
        });
        
        confirmDeleteBtn.addEventListener('click', function() {
            if (productToDelete) {
                // Send delete request to the server
                fetch(`/api/products/${productToDelete}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Remove the product from the UI
                        const productElement = document.querySelector(`.product-item[data-id="${productToDelete}"]`);
                        if (productElement) {
                            productElement.remove();
                        }
                    } else {
                        alert('Erro ao remover o produto: ' + (data.message || 'Erro desconhecido'));
                    }
                    confirmModal.style.display = 'none';
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Erro ao remover o produto');
                    confirmModal.style.display = 'none';
                });
            }
        });
        
        cancelDeleteBtn.addEventListener('click', function() {
            productToDelete = null;
            confirmModal.style.display = 'none';
        });
        
        // Search functionality
        searchBtn.addEventListener('click', searchProducts);
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchProducts();
            }
        });
        
        function searchProducts() {
            const query = searchInput.value.trim();
            // Implement search functionality - this would typically make an API call
            // and update the product list
            console.log('Searching for:', query);
            // In a real implementation, you would fetch and update the product list here
        }
    });
</script>

% include('footer.tpl')
